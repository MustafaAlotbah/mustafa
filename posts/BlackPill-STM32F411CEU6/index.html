<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="The Black Pill (STM32F411CEU6)" />
<meta property="og:locale" content="en" />
<meta name="description" content="&lt;p&gt;&lt;img src=&quot;https://i0.wp.com/github.com/WeActStudio/WeActStudio.MiniSTM32F4x1/raw/master/images/STM32F4x1-V30_3D.jpg?ssl=1&quot; alt=&quot;Description of the image&quot; style=&quot;float: right; margin-right: 15px; width: 250px;&quot; /&gt;&lt;/p&gt;" />
<meta property="og:description" content="&lt;p&gt;&lt;img src=&quot;https://i0.wp.com/github.com/WeActStudio/WeActStudio.MiniSTM32F4x1/raw/master/images/STM32F4x1-V30_3D.jpg?ssl=1&quot; alt=&quot;Description of the image&quot; style=&quot;float: right; margin-right: 15px; width: 250px;&quot; /&gt;&lt;/p&gt;" />
<link rel="canonical" href="http://localhost:4000/posts/BlackPill-STM32F411CEU6/" />
<meta property="og:url" content="http://localhost:4000/posts/BlackPill-STM32F411CEU6/" />
<meta property="og:site_name" content="Mustafa Alotbah’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-05-17T13:41:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="The Black Pill (STM32F411CEU6)" />
<meta name="twitter:site" content="@" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-05-17T13:41:00+02:00","datePublished":"2023-05-17T13:41:00+02:00","description":"&lt;p&gt;&lt;img src=&quot;https://i0.wp.com/github.com/WeActStudio/WeActStudio.MiniSTM32F4x1/raw/master/images/STM32F4x1-V30_3D.jpg?ssl=1&quot; alt=&quot;Description of the image&quot; style=&quot;float: right; margin-right: 15px; width: 250px;&quot; /&gt;&lt;/p&gt;","headline":"The Black Pill (STM32F411CEU6)","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/BlackPill-STM32F411CEU6/"},"url":"http://localhost:4000/posts/BlackPill-STM32F411CEU6/"}</script>
<!-- End Jekyll SEO tag -->


  <title>The Black Pill (STM32F411CEU6) | Mustafa Alotbah's Blog
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">

<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Mustafa Alotbah's Blog">
<meta name="application-name" content="Mustafa Alotbah's Blog">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.27.20/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- JavaScript -->

  
    <!-- Switch the mode between dark and light. -->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() {
      return 'mode';
    }
    static get MODE_ATTR() {
      return 'data-mode';
    }
    static get DARK_MODE() {
      return 'dark';
    }
    static get LIGHT_MODE() {
      return 'light';
    }
    static get ID() {
      return 'mode-toggle';
    }

    constructor() {
      let self = this;this.sysDarkPrefers.addEventListener('change', () => {
        if (self.hasMode) {
          self.clearMode();
        }
        self.notify();
      });

      if (!this.hasMode) {
        return;
      }

      if (this.isDarkMode) {
        this.setDark();
      } else {
        this.setLight();
      }
    }

    get sysDarkPrefers() {
      return window.matchMedia('(prefers-color-scheme: dark)');
    }

    get isPreferDark() {
      return this.sysDarkPrefers.matches;
    }

    get isDarkMode() {
      return this.mode === ModeToggle.DARK_MODE;
    }

    get hasMode() {
      return this.mode != null;
    }

    get mode() {
      return sessionStorage.getItem(ModeToggle.MODE_KEY);
    }get modeStatus() {
      if (this.hasMode) {
        return this.mode;
      } else {
        return this.isPreferDark ? ModeToggle.DARK_MODE : ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      document.documentElement.removeAttribute(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }notify() {
      window.postMessage(
        {
          direction: ModeToggle.ID,
          message: this.modeStatus
        },
        '*'
      );
    }

    flipMode() {
      if (this.hasMode) {
        this.clearMode();
      } else {
        if (this.isPreferDark) {
          this.setLight();
        } else {
          this.setDark();
        }
      }

      this.notify();
    }
  }

  const modeToggle = new ModeToggle();
</script>

  

  <!-- A placeholder to allow defining custom metadata -->





<!-- Link to the GitHub Dark theme stylesheet -->
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css">
<!-- <link rel="stylesheet" href="path/to/your/custom-styles.css"> -->
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

<!-- Include the Line Numbers Plugin JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>


<!-- Initialize Highlight.js -->
<script>
  document.addEventListener('DOMContentLoaded', (event) => {
    hljs.highlightAll();
    hljs.initLineNumbersOnLoad();
  });
</script>

<!-- Override background color with inline styles -->
<style>
  .hljs {
    background: #151515 !important; /* Replace with your desired background color */
    border: 1px solid #444; /* Gray border */
    border-radius: 8px; /* Rounded corners */
    padding: 10px; /* Optional: Add some padding for better readability */
  }

  .hljs-ln-numbers {
    text-align: right !important;
    padding-right: 5px !important;
    user-select: none !important;
    opacity: 0.5 !important;
}

.hljs-ln-code {
    padding-left: 5px !important;
}
</style>

<script type="text/x-mathjax-config">
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\(', '\)']],
      displayMath: [['$$', '$$'], ['\[', '\]']]
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
  };
</script>
<script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/mustafa.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <h1 class="site-title">
      <a href="/">Mustafa Alotbah's Blog</a>
    </h1>
    <p class="site-subtitle fst-italic mb-0">A Computer Science dedicated blog.</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>CATEGORIES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>TAGS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>ABOUT</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
        <a
          href="https://github.com/mustafaalotbah"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['mustafa.alotbah','gmail.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
      

      
        <a
          href="https://www.linkedin.com/in/alotbah"
          aria-label="linkedin"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-linkedin"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">Home</a>
            </span>

          
        
          
        
          
            
              <span>The Black Pill (STM32F411CEU6)</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  




<!-- return -->




<article class="px-1">
  <header>
    <h1 data-toc-skip>The Black Pill (STM32F411CEU6)</h1>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1684323660"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  May 17, 2023
</time>

      </span>

      <!-- lastmod date -->
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              <a href="https://github.com/mustafaalotbah">Mustafa Alotbah</a>
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="5073 words"
>
  <em>28 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  <div class="content">
    <div style="display: flex; flex-wrap: wrap; align-items: center;">
  <div style="flex: 0 0 auto; min-width: 200px;">
    <p><a href="https://i0.wp.com/github.com/WeActStudio/WeActStudio.MiniSTM32F4x1/raw/master/images/STM32F4x1-V30_3D.jpg?ssl=1" class="popup img-link  shimmer"><img src="https://i0.wp.com/github.com/WeActStudio/WeActStudio.MiniSTM32F4x1/raw/master/images/STM32F4x1-V30_3D.jpg?ssl=1" alt="Description of the image" style="float: right; margin-right: 15px; width: 250px;" loading="lazy"></a></p>
  </div>
  <div style="flex: 1; min-width: 200px;">

    <p>In this article, we will get you started with the STM32F411CE board (aka the black pill). For a complete overview of the board <a href="https://stm32-base.org/boards/STM32F411CEU6-WeAct-Black-Pill-V2.0.html">see this</a>.</p>

    <p>This chip is based on ARM Cortex-M4 32-Bit Architecture with clock frequency of 100 MHz RAM of 512KB.</p>

    <p>This chip is manufactured by the Dutch company STMicroelectronics, which is based in Switzerland. The company provides several tools to develop for their chips. The official IDE is called the <a href="https://www.st.com/en/development-tools/stm32cubeide.html">STM32CUBE IDE</a> which is used for this quick tutorial.</p>

  </div>
</div>

<h2 id="getting-started">1. <span class="me-2">Getting Started</span><a href="#getting-started" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="overview">1.1. <span class="me-2">Overview</span><a href="#overview" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The illustration below demonstrates the characteristics of the pins on the board.</p>

<p><a href="https://i0.wp.com/github.com/WeActStudio/WeActStudio.MiniSTM32F4x1/raw/master/images/STM32F4x1_PinoutDiagram_RichardBalint.png?ssl=1" class="popup img-link  shimmer"><img src="https://i0.wp.com/github.com/WeActStudio/WeActStudio.MiniSTM32F4x1/raw/master/images/STM32F4x1_PinoutDiagram_RichardBalint.png?ssl=1" alt="The pins diagram of the chip/board." loading="lazy"></a></p>

<h3 id="requirements">1.2. <span class="me-2">Requirements</span><a href="#requirements" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ol>
  <li>
    <p><strong>Development Environment</strong>: You can choose either of the following:</p>

    <ul>
      <li><strong>STM32Cube IDE</strong>:</li>
    </ul>

    <p>This is the official STM32 IDE and it includes build environment. you can download it from <a href="https://www.st.com/en/development-tools/stm32cubeide.html">here</a>.</p>

    <ul>
      <li>
        <p><strong>CMake and Custom IDE</strong>:</p>

        <p>Assuming you have CMake installed.</p>

        <ol>
          <li>
            <p>Download the <em>GNU Arm Embedded Toolchain</em> from <a href="https://developer.arm.com/downloads/-/gnu-rm">here</a> and add it to <code class="language-plaintext highlighter-rouge">PATH</code>. This is important to compile the project.</p>
          </li>
          <li>
            <p>Download the <em>OpenOCD</em> from <a href="https://gnutoolchains.com/arm-eabi/openocd/">here</a> and add it to <code class="language-plaintext highlighter-rouge">PATH</code>. This is important for debugging.</p>
          </li>
          <li>
            <p>Download the <strong>STM32CubeMX</strong> from <a href="https://www.st.com/en/development-tools/stm32cubemx.html">here</a> and add it to <code class="language-plaintext highlighter-rouge">PATH</code>. This is important to generate the project files along HAL library.</p>
          </li>
        </ol>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>STM32 Cube Programmer</strong>: To upload the binary to the chip. You can download it from <a href="https://www.st.com/en/development-tools/stm32cubeprog.html">here</a>.</p>
  </li>
</ol>

<h3 id="setting-up-the-environment">1.3. <span class="me-2">Setting up the environment</span><a href="#setting-up-the-environment" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<h3 id="setting-up-the-clock">1.4. <span class="me-2">Setting Up the Clock</span><a href="#setting-up-the-clock" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Set <code class="language-plaintext highlighter-rouge">HSE</code> and <code class="language-plaintext highlighter-rouge">LSE</code> to crystal clock on the <code class="language-plaintext highlighter-rouge">RCC</code>. Now we will configure the clock depending on the chip. For example, the <code class="language-plaintext highlighter-rouge">STM32F411CEUx</code> from <em>Weact</em> is connected to a $32.786$ kHz resonator on the LSE and a 25 MHz resonator on the HSE, so the configuration diagram should be like this:</p>

<ul>
  <li>Set <em>PPL Source Mux</em> to <em>HSE</em></li>
  <li>Set <code class="language-plaintext highlighter-rouge">/M</code> = <code class="language-plaintext highlighter-rouge">/ 25</code></li>
  <li>Set <code class="language-plaintext highlighter-rouge">*N</code> = <code class="language-plaintext highlighter-rouge">X 192</code></li>
  <li>Set <code class="language-plaintext highlighter-rouge">/Q</code> = <code class="language-plaintext highlighter-rouge">/ 4</code></li>
  <li>Set <code class="language-plaintext highlighter-rouge">/P</code> = <code class="language-plaintext highlighter-rouge">/ 2</code></li>
  <li>Set <em>System Clock Mux</em> to <em>PLLCLK</em></li>
  <li>Set <code class="language-plaintext highlighter-rouge">AHB Prescaler</code> = <code class="language-plaintext highlighter-rouge">/ 1</code></li>
</ul>

<p>Notice that the STM32F411CEUx supports up to 100 MHz clocking, but since the Universal Serial Bus On-The-Go Full Speed (USB_OTG_FS) requires a dedicated 48 MHz clock (datasheet 3.27), the clock responsible for this (48 MHz clocks) comes from the Main PLL directly. By clocking the HCLK to 96 MHz, we can achieve a division that results in 48 MHz for this clock.</p>

<h2 id="project-structure">2. <span class="me-2">Project Structure</span><a href="#project-structure" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<!-- TODO: Starting the project -->

<h3 id="project-settings-myprojectioc">2.1. <span class="me-2">Project Settings (<code class="language-plaintext highlighter-rouge">myproject.ioc</code>)</span><a href="#project-settings-myprojectioc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>This file defines the settings of the chip when it starts, and the necessary code is re-generated whenever this file is updated. From here, you can set the initial mode of the pins (input. output, etc…), Direct Memory Access (DMA) settings, timers and more.</p>

<h3 id="linker-script-stm32f411ceu6_flashld">2.2. <span class="me-2">Linker Script (<code class="language-plaintext highlighter-rouge">STM32F411CEU6_FLASH.ld</code>)</span><a href="#linker-script-stm32f411ceu6_flashld" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Let’s take a look at the linker script generated by STM32 Cube MX:</p>

<pre><code class="language-c">/* Entry Point */
ENTRY(Reset_Handler)

/* Highest address of the user mode stack */
_estack = ORIGIN(RAM) + LENGTH(RAM);    /* end of RAM */
/* Generate a link error if heap and stack don't fit into RAM */
_Min_Heap_Size = 0x200;      /* required amount of heap  */
_Min_Stack_Size = 0x400; /* required amount of stack */

/* Specify the memory areas */
MEMORY
{
RAM (xrw)      : ORIGIN = 0x20000000, LENGTH = 20K
FLASH (rx)     : ORIGIN = 0x08000000, LENGTH = 64K
}
/* ... */
</code></pre>

<p>In the linker script (<code class="language-plaintext highlighter-rouge">STM32F411CEU6_FLASH.ld</code>), the <code class="language-plaintext highlighter-rouge">ENTRY(Reset_Handler)</code> directive specifies this entry point.</p>

<p>The <code class="language-plaintext highlighter-rouge">Reset_Handler</code> is the entry point for the program and is defined in the assembly file <code class="language-plaintext highlighter-rouge">startup_stm32f103xb.s</code>.</p>

<ul>
  <li>It is responsible for initializing the system and preparing the execution environment before jumping to the main application code.</li>
  <li>When the microcontroller is reset, the <code class="language-plaintext highlighter-rouge">Reset_Handler</code> is the first function that gets executed as specified in the above linker.</li>
  <li>This handler is crucial in setting up the system by configuring the stack pointer, initializing data segments, and calling the <code class="language-plaintext highlighter-rouge">main()</code> function.</li>
</ul>

<h4 id="memory-layout">2.2.1. <span class="me-2">Memory Layout</span><a href="#memory-layout" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>The memory configuration is defined in the linker script under the <code class="language-plaintext highlighter-rouge">MEMORY</code> section. This section specifies the start addresses and lengths of different memory regions in the microcontroller:</p>

<ul>
  <li><strong>RAM</strong>: The RAM region is defined with a starting address of <code class="language-plaintext highlighter-rouge">0x20000000</code> and a length of 20KB. This is the area where the runtime data (variables, stack, and heap) will be stored.</li>
  <li><strong>FLASH</strong>: The FLASH region, starting at <code class="language-plaintext highlighter-rouge">0x08000000</code> with a length of 64KB, is used to store the program code and constants.</li>
</ul>

<h4 id="stack-and-heap-configuration">2.2.2. <span class="me-2">Stack and Heap Configuration</span><a href="#stack-and-heap-configuration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<ul>
  <li>
    <p><strong>_estack</strong>: The <code class="language-plaintext highlighter-rouge">_estack</code> symbol defines the highest address of the stack in RAM. It is calculated as the sum of the starting address of RAM (<code class="language-plaintext highlighter-rouge">ORIGIN(RAM)</code>) and the total length of RAM (<code class="language-plaintext highlighter-rouge">LENGTH(RAM)</code>).
This ensures that the stack starts at the end of the available RAM space and grows downwards.</p>
  </li>
  <li>
    <p><strong>_Min_Heap_Size</strong>: This value specifies the minimum required heap size, which is set to <code class="language-plaintext highlighter-rouge">0x200</code> (512 bytes).
The heap is used for dynamic memory allocation during runtime.</p>
  </li>
  <li>
    <p><strong>_Min_Stack_Size</strong>: This value defines the minimum required stack size, set to <code class="language-plaintext highlighter-rouge">0x400</code> (1024 bytes).
The stack is used for storing local variables and function call information during execution.</p>
  </li>
</ul>

<p>These values ensure that the heap and stack have enough space within the RAM, preventing overlap and potential runtime errors. The linker script will generate an error if the specified heap and stack sizes do not fit within the defined RAM area.</p>

<h3 id="c-entry-file-coresrcmainc">2.3. <span class="me-2">C Entry File (<code class="language-plaintext highlighter-rouge">core/Src/main.c</code>)</span><a href="#c-entry-file-coresrcmainc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>This is the main source code, where the entry function resides. Also, this is place where most of the generated code done by the IDE is written after updating <em>myproject.ioc</em>.</p>

<p>We will look into two important functions here.</p>

<h4 id="static-void-mx_gpio_initvoid">2.3.1. <span class="me-2">static void MX_GPIO_Init(void)</span><a href="#static-void-mx_gpio_initvoid" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>This function sets up the initial settings for the IO pins of the chip. On the board the blue LED is connected to pin C13. If we set this pin mode to GPIO_Output mode in the <em>myproject.ioc</em> file, as in the illustration below</p>

<p><a href="/assets/images/embedded/stm32_cubemx/GPIO_configuration_stm32f411ceux.webp" class="popup img-link  shimmer"><img src="/assets/images/embedded/stm32_cubemx/GPIO_configuration_stm32f411ceux.webp" alt="GPIO Configuration of STM32F4CEUx series on STM32 CubeMX" loading="lazy"></a></p>

<p>Figure 2: Configuring the chip’s pins</p>

<p>we can see that the IDE has generated the following code in the function MX_GPIO_Init:</p>

<pre><code class="language-cpp">GPIO_InitTypeDef GPIO_InitStruct = {0};

/* GPIO Ports Clock Enable */
__HAL_RCC_GPIOC_CLK_ENABLE();

/*Configure GPIO pin Output Level */
HAL_GPIO_WritePin(GPIOC, GPIO_PIN_13, GPIO_PIN_RESET);

/*Configure GPIO pin : PC13 */
GPIO_InitStruct.Pin = GPIO_PIN_13;
GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
GPIO_InitStruct.Pull = GPIO_NOPULL;
GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
HAL_GPIO_Init(GPIOC, &amp;GPIO_InitStruct);
</code></pre>

<p>Lines from 9 to 14 are responsible for initializing the pin C13. We can see in line that the HAL library provides the function <code class="language-plaintext highlighter-rouge">HAL_GPIO_Init</code> which takes first the name of the Pins block and then a pointer to a structure <code class="language-plaintext highlighter-rouge">GPIO_InitTypeDef</code>. This is also how the pin settings is changed programmatically. The details of the pins settings are explained in the following section.</p>

<hr />

<p>The <strong>Pull</strong> variable specifies which resistors should be connected to the pin. The possible configurations are</p>

<ul>
  <li>Pull down (<code class="language-plaintext highlighter-rouge">GPIO_PULLDOWN</code>)</li>
  <li>Pull up (<code class="language-plaintext highlighter-rouge">GPIO_PULLUP</code>)</li>
  <li>No resistor (<code class="language-plaintext highlighter-rouge">GPIO_NOPULL</code>)</li>
</ul>

<p>The pull down resistor connects the pin to the ground, while the pull up resistor connects the pin to 3.3V.</p>

<hr />

<h2 id="uploading-firmware">3. <span class="me-2">Uploading Firmware</span><a href="#uploading-firmware" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Uploading firmware to an STM32 microcontroller can be achieved using different interfaces such as DFU (Device Firmware Upgrade) or UART. Below are the steps for using both methods with the <em>WeAct</em> Black Pill board.</p>

<h3 id="using-dfu-mode">3.1. <span class="me-2">Using DFU Mode</span><a href="#using-dfu-mode" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>To upload the firmware via DFU mode, connect your device via USB and use the following command:</p>

<pre><code class="language-bash">STM32_Programmer_CLI -c port=usb1 -w \Debug\app.bin 0x08000000
</code></pre>

<ul>
  <li><code class="language-plaintext highlighter-rouge">port=usb1</code>: Specifies the USB port.</li>
  <li><code class="language-plaintext highlighter-rouge">-w \Debug\app.bin</code>: Indicates the path to the binary file.</li>
  <li><code class="language-plaintext highlighter-rouge">0x08000000</code>: Specifies the start address in the flash memory.</li>
</ul>

<h3 id="using-uart">3.2. <span class="me-2">Using UART</span><a href="#using-uart" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>To upload the firmware via UART, use the following command:</p>

<pre><code class="language-bash">STM32_Programmer_CLI -c port=COM10 -w \Debug\app.elf
</code></pre>

<ul>
  <li><code class="language-plaintext highlighter-rouge">port=COM10</code>: Specifies the COM port.</li>
  <li><code class="language-plaintext highlighter-rouge">-w \Debug\app.elf</code>: Indicates the path to the ELF file.</li>
</ul>

<p>To reset and disable the read protection of the microcontroller, you can use:</p>

<pre><code class="language-bash">STM32_Programmer_CLI -c port=COM10 -rdu
</code></pre>

<hr />

<h2 id="working-with-gpios">4. <span class="me-2">Working with GPIOs</span><a href="#working-with-gpios" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>GPIO (General Purpose Input/Output) is crucial for interfacing with the STM32 microcontroller’s pins. Below is an overview of how to configure and use GPIOs.</p>

<h3 id="gpio-initialization-gpio_inittypedef">4.1. <span class="me-2">GPIO Initialization (<code class="language-plaintext highlighter-rouge">GPIO_InitTypeDef</code>)</span><a href="#gpio-initialization-gpio_inittypedef" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p><code class="language-plaintext highlighter-rouge">GPIO_InitTypeDef</code> is a structure used to define the specifications of a GPIO pin. Below are the key fields in this structure:</p>

<pre><code class="language-cpp">typedef struct  
{  
  uint32_t Pin;
  uint32_t Mode
  uint32_t Pull;
  uint32_t Speed;  
  uint32_t Alternate; // Only available in &gt;= Cortex-M4
} GPIO_InitTypeDef;
</code></pre>

<ul>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">Pin</code>:</strong> Specifies the GPIO pins to be configured. Multiple pins can be selected using a bitwise OR operation. Example: <code class="language-plaintext highlighter-rouge">(GPIO_PIN_0 | GPIO_PIN_1)</code>.
  Mask of the pin, <code class="language-plaintext highlighter-rouge">(GPIO_PIN_0 = 0x0001)</code>, <code class="language-plaintext highlighter-rouge">(GPIO_PIN_1 = 0x0002)</code>…</p>
  </li>
  <li><strong><code class="language-plaintext highlighter-rouge">Mode</code>:</strong> Defines the operating mode for the selected pins. The following modes are available:
    <ol>
      <li>Input Mode
        <ul>
          <li><code class="language-plaintext highlighter-rouge">GPIO_MODE_INPUT:</code> Input Floating Mode
            <blockquote>
              <p>The <strong>input</strong> mode changes a variable variable according to the voltage applied to the pin (Note this should never exceed 3.3V for most pins).</p>
            </blockquote>
          </li>
        </ul>
      </li>
      <li>Output Mode
        <ul>
          <li><code class="language-plaintext highlighter-rouge">GPIO_MODE_OUTPUT_PP:</code> Output Push-Pull
            <blockquote>
              <p>The <strong>push-pull mode</strong> sets up the pin for a single direction output. The pin state, can either be high or low.</p>
            </blockquote>
          </li>
          <li><code class="language-plaintext highlighter-rouge">GPIO_MODE_OUTPUT_OD:</code> Output Open Drain
            <blockquote>
              <p>The <strong>open-drain mode</strong>, sets up the pin to accept bidirectional input and output. (For more <a href="https://open4tech.com/open-drain-output-vs-push-pull-output/">see this article</a>).</p>
            </blockquote>
          </li>
        </ul>
      </li>
      <li>Alternate Function
        <ul>
          <li><code class="language-plaintext highlighter-rouge">GPIO_MODE_AF_PP:</code> Push-Pull</li>
          <li><code class="language-plaintext highlighter-rouge">GPIO_MODE_AF_OD:</code> Open Drain</li>
        </ul>
      </li>
      <li>Analog Mode
        <ul>
          <li><code class="language-plaintext highlighter-rouge">GPIO_MODE_ANALOG:</code> Analog Mode
            <blockquote>
              <p>The <strong>analog</strong> mode allows the pin to read the voltage applied to it. However, not all pins are able to be set to this mode, in the case of this chip, these pins are A0..A7 as well as B0 and B1, which also correspond to ADC0..ADC9.
Accessing the analog value read from the pin needs additional configuration, such as direct memory access (DMA), which we will look into in the following sections.</p>
            </blockquote>
          </li>
        </ul>
      </li>
      <li>External Interrupt
        <ul>
          <li><code class="language-plaintext highlighter-rouge">GPIO_MODE_IT_RISING:</code> Rising Edge</li>
          <li><code class="language-plaintext highlighter-rouge">GPIO_MODE_IT_FALLING:</code> Falling Edge</li>
          <li><code class="language-plaintext highlighter-rouge">GPIO_MODE_IT_RISING_FALLING:</code> Rising and Falling Edge</li>
        </ul>
      </li>
      <li>External Event
        <ul>
          <li><code class="language-plaintext highlighter-rouge">GPIO_MODE_EVT_RISING:</code> Rising Edge</li>
          <li><code class="language-plaintext highlighter-rouge">GPIO_MODE_EVT_FALLING:</code> Falling Edge</li>
          <li><code class="language-plaintext highlighter-rouge">GPIO_MODE_EVT_RISING_FALLING:</code> Rising and Falling Edge</li>
        </ul>
      </li>
    </ol>
  </li>
  <li><strong><code class="language-plaintext highlighter-rouge">Pull</code>:</strong> Specifies the internal pull-up or pull-down resistor activation:
    <ol>
      <li><code class="language-plaintext highlighter-rouge">GPIO_NOPULL</code>: No pull-up or pull-down activation.</li>
      <li><code class="language-plaintext highlighter-rouge">GPIO_PULLUP</code>: Pull-up resistor activation.</li>
      <li><code class="language-plaintext highlighter-rouge">GPIO_PULLDOWN</code>: Pull-down resistor activation.</li>
    </ol>
  </li>
  <li><strong><code class="language-plaintext highlighter-rouge">Speed</code>:</strong> Defines the speed for the GPIO pin:
    <ol>
      <li><code class="language-plaintext highlighter-rouge">GPIO_SPEED_FREQ_LOW</code>: 2 MHz.</li>
      <li><code class="language-plaintext highlighter-rouge">GPIO_SPEED_FREQ_MEDIUM</code>: 12.5 to 50 MHz.</li>
      <li><code class="language-plaintext highlighter-rouge">GPIO_SPEED_FREQ_HIGH</code>: 25 to 100 MHz.</li>
      <li><code class="language-plaintext highlighter-rouge">GPIO_SPEED_FREQ_VERY_HIGH</code>: 50 to 200 MHz.</li>
    </ol>
  </li>
</ul>

<p>An example of initializing a pin:</p>

<pre><code class="language-cpp">GPIO_InitTypeDef GPIO_InitStruct = {};
GPIO_InitStruct.Pin = GPIO_PIN_13;  
GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;  
GPIO_InitStruct.Pull = GPIO_NOPULL;  
GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;  
HAL_GPIO_Init(GPIOC, &amp;GPIO_InitStruct);
</code></pre>

<h3 id="gpio-pin-states-gpio_pinstate">4.2. <span class="me-2">GPIO Pin States (<code class="language-plaintext highlighter-rouge">GPIO_PinState</code>)</span><a href="#gpio-pin-states-gpio_pinstate" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>A GPIO pin can be in one of the following two states:</p>

<ol>
  <li><strong>Reset State (<code class="language-plaintext highlighter-rouge">GPIO_PIN_RESET</code>):</strong> Logical low (<code class="language-plaintext highlighter-rouge">0</code>).</li>
  <li><strong>Set State (<code class="language-plaintext highlighter-rouge">GPIO_PIN_SET</code>):</strong> Logical high (<code class="language-plaintext highlighter-rouge">1</code>).</li>
</ol>

<h4 id="writing-to-a-pin">4.2.1. <span class="me-2">Writing to a Pin</span><a href="#writing-to-a-pin" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>To set or reset a GPIO pin, you can use the following methods:</p>

<h5 id="setting-a-pin"><span class="me-2">Setting a Pin</span><a href="#setting-a-pin" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5>

<pre><code class="language-c">GPIOA -&gt; BSSR = GPIO_PIN_0;                         // fast
GPIOA -&gt; ODR |= GPIO_PIN_0;                         // legacy
HAL_GPIO_WritePin(GPIOA, GPIO_PIN_0, GPIO_PIN_SET); // HAL Library
</code></pre>

<h5 id="resetting-a-pin"><span class="me-2">Resetting a Pin</span><a href="#resetting-a-pin" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5>

<pre><code class="language-c">GPIOA -&gt; BSSR = (uint32_t)GPIO_PIN_0  &lt;&lt; 16U;         // fast
GPIOA -&gt; ODR &amp;= ~GPIO_PIN_0;                          // legacy
HAL_GPIO_WritePin(GPIOA, GPIO_PIN_0, GPIO_PIN_RESET); // HAL Library
</code></pre>

<p>No Masking needed for setting/resetting a pin when using BSRR register, ODR Registers stores the output values and we can use it to read the output values.</p>

<p>Note that the function <code class="language-plaintext highlighter-rouge">HAL_GPIO_WritePin</code> writes the value to the pin <strong>atomically</strong> without OR’ing it with other masks. That means interrupts do not have to be disabled.</p>

<h4 id="reading-a-pin">4.2.2. <span class="me-2">Reading a Pin</span><a href="#reading-a-pin" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>Just like reading the Output data from ODR, we can read the input data from IDR.</p>

<pre><code class="language-c">uint8_t PA0;
PA0 = GPIOA -&gt; IDT &amp; GPIO_PIN_0;            // legacy
PA0 = HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_0);  // HAL Library
</code></pre>

<h3 id="gpio-port-configuration-gpio_typedef">4.3. <span class="me-2">GPIO Port Configuration (<code class="language-plaintext highlighter-rouge">GPIO_TypeDef</code>)</span><a href="#gpio-port-configuration-gpio_typedef" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Each GPIO port is represented by a <code class="language-plaintext highlighter-rouge">GPIO_TypeDef</code> structure, which contains the following registers:</p>

<pre><code class="language-cpp">typedef struct  
{  
  __IO uint32_t MODER;   // Mode Register
  __IO uint32_t OTYPER;  // Output Type Register
  __IO uint32_t OSPEEDR  // Output Speed Register
  __IO uint32_t PUPDR    // Pull-Up Pull-Down Register
  __IO uint32_t IDR;     // Input Data Register
  __IO uint32_t ODR;     // Output Data Rigister
  __IO uint32_t BSRR     // Bit Set/Reset Register
  __IO uint32_t LCKR;    // Lock Register
  __IO uint32_t AFR[2];  // Alternate Function Registers
} GPIO_TypeDef;
</code></pre>

<ol>
  <li><code class="language-plaintext highlighter-rouge">MODER</code>: Port Mode Register (offset <code class="language-plaintext highlighter-rouge">0x00</code>).
    <blockquote>
      <p>Each pin has 2 bits in this register:</p>
      <ul>
        <li><code class="language-plaintext highlighter-rouge">00</code>: Input mode</li>
        <li><code class="language-plaintext highlighter-rouge">01</code>: General-purpose output mode</li>
        <li><code class="language-plaintext highlighter-rouge">10</code>: Alternate function mode (like UART, SPI, etc.)</li>
        <li><code class="language-plaintext highlighter-rouge">11</code>: Analog mode</li>
      </ul>
    </blockquote>
  </li>
  <li><code class="language-plaintext highlighter-rouge">OTYPER</code>: Port Output Type Register (offset <code class="language-plaintext highlighter-rouge">0x04</code>).
    <blockquote>
      <p>Output Type</p>
      <ul>
        <li><code class="language-plaintext highlighter-rouge">0</code>: Output push-pull (default)</li>
        <li><code class="language-plaintext highlighter-rouge">1</code>: Output open-drain</li>
      </ul>
    </blockquote>
  </li>
  <li><code class="language-plaintext highlighter-rouge">OSPEEDR</code>: Port Output Speed Register (offset <code class="language-plaintext highlighter-rouge">0x08</code>).
    <blockquote>
      <p>Each pin has 2 bits in this register:</p>
      <ul>
        <li><code class="language-plaintext highlighter-rouge">00</code>: Low speed</li>
        <li><code class="language-plaintext highlighter-rouge">01</code>: Medium speed</li>
        <li><code class="language-plaintext highlighter-rouge">10</code>: High speed</li>
        <li><code class="language-plaintext highlighter-rouge">11</code>: Very high speed</li>
      </ul>
    </blockquote>
  </li>
  <li><code class="language-plaintext highlighter-rouge">PUPDR</code>: Port Pull-up/Pull-down Register (offset <code class="language-plaintext highlighter-rouge">0x0C</code>).
    <blockquote>
      <p>Each pin has 2 bits in this register:</p>
      <ul>
        <li><code class="language-plaintext highlighter-rouge">00</code>: No pull-up, pull-down</li>
        <li><code class="language-plaintext highlighter-rouge">01</code>: Pull-up</li>
        <li><code class="language-plaintext highlighter-rouge">10</code>: Pull-down</li>
        <li><code class="language-plaintext highlighter-rouge">11</code>: Reserved</li>
      </ul>
    </blockquote>
  </li>
  <li><code class="language-plaintext highlighter-rouge">IDR</code>: Input Data Register (offset <code class="language-plaintext highlighter-rouge">0x10</code>).</li>
  <li><code class="language-plaintext highlighter-rouge">ODR</code>: Output Data Register (offset <code class="language-plaintext highlighter-rouge">0x14</code>).</li>
  <li><code class="language-plaintext highlighter-rouge">BSRR</code>: Port Bit Set/Reset Register (offset <code class="language-plaintext highlighter-rouge">0x18</code>).
    <blockquote>
      <p>This 32-bit register allows <strong>atomic</strong> bit-wise operations to set or reset individual bits in the <code class="language-plaintext highlighter-rouge">ODR</code>:</p>
      <ul>
        <li>The lower 16 bits (0-15) are used to set the corresponding ODR bits.</li>
      </ul>

      <pre><code class="language-cpp">// Set Pin A0
GPIOA-&gt;BSRR = GPIO_PIN_0;
</code></pre>

      <ul>
        <li>The upper 16 bits (16-31) are used to reset the corresponding ODR bits.</li>
      </ul>

      <pre><code class="language-cpp">// Reset Pin A0
GPIOA -&gt; BSSR = (uint32_t)GPIO_PIN_0 &lt;&lt; 16U;
</code></pre>

    </blockquote>
  </li>
  <li><code class="language-plaintext highlighter-rouge">LCKR</code>: Port Configuration Lock Register (offset <code class="language-plaintext highlighter-rouge">0x1C</code>).
    <blockquote>
      <p>This 16-bit register locks the configuration of the GPIO port to prevent accidental changes</p>
      <ul>
        <li>Once locked, the configuration of the GPIO cannot be modified until the next reset.</li>
      </ul>

      <pre><code class="language-cpp">// Step 1: Write the pin's lock pattern and set LCKK bit
GPIOA-&gt;LCKR = GPIO_LCKR_LCKK | GPIO_PIN_0;

// Step 2: Write the pin's lock pattern without LCKK bit
GPIOA-&gt;LCKR = GPIO_PIN_0;

// Step 3: Write the pin's lock pattern with LCKK bit again
GPIOA-&gt;LCKR = GPIO_LCKR_LCKK | GPIO_PIN_0;

// Step 4: Read LCKR to complete the lock sequence
uint32_t temp = GPIOA-&gt;LCKR;

// The pin is now locked, and the configuration cannot be changed until a reset occurs
</code></pre>

    </blockquote>
  </li>
  <li><code class="language-plaintext highlighter-rouge">AFR[2]</code>: Alternate Function Registers (offset <code class="language-plaintext highlighter-rouge">0x20</code>, <code class="language-plaintext highlighter-rouge">0x24</code>).</li>
</ol>

<p>In the following, we will at some of these registers</p>

<h3 id="gpio-portbitsetresetregister-bsrr">4.4. <span class="me-2">GPIO Port <strong>B</strong>it <strong>S</strong>et/<strong>R</strong>eset <strong>R</strong>egister (BSRR)</span><a href="#gpio-portbitsetresetregister-bsrr" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>This register is used to atomically write to an output pin. It is used this way</p>

<pre><code class="language-cpp">GPIOA -&gt; BSSR = (uint32_t)GPIO_PIN_0 &lt;&lt; 16U;
</code></pre>

<p>But this is exactly what HAL libary’s function <em>HAL_GPIO_WritePin</em> does. Hence, there is no need to access it directly for most cases.</p>

<h2 id="pulse-width-modulation-pwm">5. <span class="me-2">Pulse-Width-Modulation (PWM)</span><a href="#pulse-width-modulation-pwm" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Configuring PWM on the STM32 platform using STM32CubeIDE is a streamlined process. Beginning with the project’s configuration file, <code class="language-plaintext highlighter-rouge">_myproject.ioc_</code>, follow these steps:</p>

<h3 id="system-core-configuration">5.1. <span class="me-2">System Core Configuration</span><a href="#system-core-configuration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ol>
  <li>
    <p><strong>Clock Configuration</strong>:<br />
 Navigate to <strong>System Core</strong> &gt; <code class="language-plaintext highlighter-rouge">RCC</code>. Set both the High-Speed Clock (<code class="language-plaintext highlighter-rouge">HCLK</code>) and Low-Speed Clock (<code class="language-plaintext highlighter-rouge">LCLK</code>) sources to <strong>Crystal/Ceramic Resonator</strong>. This ensures stable and accurate clocking for the timer peripherals.</p>
  </li>
  <li>
    <p><strong>Timer Configuration</strong>:<br />
 Go to <strong>Timers</strong> &gt; <code class="language-plaintext highlighter-rouge">TIM3</code>. The <code class="language-plaintext highlighter-rouge">TIM3</code> peripheral has four channels, each capable of generating PWM signals. For this example, activate <strong>Channel 1</strong> by setting it to <strong>PWM Generation CH1</strong>, optionally the same for channel 2.</p>
  </li>
</ol>

<h3 id="pwm-frequency-and-duty-cycle-calculation">5.2. <span class="me-2">PWM Frequency and Duty Cycle Calculation</span><a href="#pwm-frequency-and-duty-cycle-calculation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The PWM signal’s frequency is governed by the following equation:</p>

<p>\[
f_\text{PWM} =\frac{f_\text{APB Timer Clock}}{(ARR+1) \cdot (PSC+1)}
\]</p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">ARR</code> (Auto-Reload Register)</strong>: Defines the maximum count value before the timer resets.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">PSC</code> (Prescaler)</strong>: Divides the timer clock frequency to adjust the PWM period.</li>
</ul>

<p>Both <code class="language-plaintext highlighter-rouge">ARR</code> and <code class="language-plaintext highlighter-rouge">PSC</code> registers hold values that are decremented by one from their actual count (i.e., an <code class="language-plaintext highlighter-rouge">ARR</code> value of 999 sets the period to 1000 counts).</p>

<p>The duty cycle of the PWM signal is determined by the following relationship:
\[
f_\text{Duty}= \frac{CCR}{ARR} [\%]
\]</p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">CCR</code> (Capture Compare Register)</strong>: Controls the pulse width of the PWM signal, directly influencing the duty cycle.</li>
</ul>

<p>These register values can be configured through the “Parameter Settings” window in STM32CubeIDE.</p>

<h3 id="timer-initialization-and-configuration">5.3. <span class="me-2">Timer Initialization and Configuration</span><a href="#timer-initialization-and-configuration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Once the parameters are set in the <code class="language-plaintext highlighter-rouge">.ioc</code> file, STM32CubeIDE generates a private variable <code class="language-plaintext highlighter-rouge">htim3</code> in the <code class="language-plaintext highlighter-rouge">main.c</code> file. This variable is an instance of the <code class="language-plaintext highlighter-rouge">TIM_HandleTypeDef</code> structure, which manages and configures the timer.</p>

<p>This generates a private variable <code class="language-plaintext highlighter-rouge">htim3</code> in <em>main.c</em>. This is the handler of the timer.</p>

<pre><code class="language-cpp">/* Private variables */  
TIM_HandleTypeDef htim3;
</code></pre>

<p><strong><code class="language-plaintext highlighter-rouge">TIM_HandleTypeDef</code> Structure Overview</strong>:</p>

<pre><code class="language-cpp">typedef struct {
  TIM_TypeDef* Instance;      // Points to the TIMx peripheral (e.g., TIM1, TIM2).
  TIM_Base_InitTypeDef init;  // Configuration parameters for the time base.
  HAL_TIM_ActiveChannel;      // Channel
  DMA_HandleTypeDef* hdma[7]; // DMA Handlers array
  HAL_LockTypeDef;            // Locking Object
  HAL_TIM_StateTypeDef;       // State
} TIM_HandleTypeDef;
</code></pre>

<p><strong>Timer Initialization Function</strong>:</p>

<p>The <code class="language-plaintext highlighter-rouge">MX_TIM3_Init()</code> function is responsible for initializing the TIM3 peripheral with the desired settings:</p>

<pre><code class="language-cpp">static void MX_TIM3_Init() {
    // Initialize the TIM3 peripheral handle
    htim3.Instance = TIM3;  
    htim3.Init.Prescaler = 0;  
    htim3.Init.CounterMode = TIM_COUNTERMODE_UP;
    htim3.Init.Period = 65535;  
    htim3.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;  
    htim3.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;  
    // Initialize the timer for PWM operation
    if (HAL_TIM_PWM_Init(&amp;htim3) != HAL_OK) Error_Handler(); 

    // Configure the master configuration for synchronization
    TIM_MasterConfigTypeDef sMasterConfig = {};  
    sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;  
    sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;  
    // Apply the master configuration settings
    if (HAL_TIMEx_MasterConfigSynchronization(&amp;htim3, &amp;sMasterConfig) != HAL_OK) Error_Handler(); 

    // Configure the output compare (OC) settings for PWM on channel 1 and 2
    TIM_OC_InitTypeDef sConfigOC = {0};  
    sConfigOC.OCMode = TIM_OCMODE_PWM1;  
    sConfigOC.Pulse = 0;  
    sConfigOC.OCPolarity = TIM_OCPOLARITY_HIGH;  
    sConfigOC.OCFastMode = TIM_OCFAST_DISABLE;
    // Configure PWM channel 1 with the above settings
    if (HAL_TIM_PWM_ConfigChannel(&amp;htim3, &amp;sConfigOC, TIM_CHANNEL_1) != HAL_OK) Error_Handler(); 
    // Configure PWM channel 2 with the above settings
    if (HAL_TIM_PWM_ConfigChannel(&amp;htim3, &amp;sConfigOC, TIM_CHANNEL_2) != HAL_OK) Error_Handler();  

    // Call post-initialization function to configure GPIO and other settings
    HAL_TIM_MspPostInit(&amp;htim3);
}
</code></pre>

<h3 id="starting-pwm-output">5.4. <span class="me-2">Starting PWM Output</span><a href="#starting-pwm-output" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>To begin PWM signal generation on the configured channels, the following function calls are necessary within the <code class="language-plaintext highlighter-rouge">main()</code> function:</p>

<pre><code class="language-cpp">  
int main(void)  
{
    /* ... */
    
    // Start PWM on Channel 1 
    if (HAL_TIM_PWM_Start(&amp;htim3, TIM_CHANNEL_1) != HAL_OK) Error_Handler(); 
    
    // Start PWM on Channel 2
    if (HAL_TIM_PWM_Start(&amp;htim3, TIM_CHANNEL_2) != HAL_OK) Error_Handler();
    
    /* ... */
}
</code></pre>

<p>These function calls initiate PWM generation on the specified channels, allowing the microcontroller to output the configured PWM signals.</p>

<h2 id="timers">6. <span class="me-2">Timers</span><a href="#timers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>General-purpose timers on the STM32 are highly versatile and can be used for a variety of timing tasks. Below are the steps to configure a general-purpose timer (e.g., <code class="language-plaintext highlighter-rouge">TIM2</code>) and set up an interrupt-based event handler.</p>

<h3 id="timer-configuration">6.1. <span class="me-2">Timer Configuration</span><a href="#timer-configuration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ol>
  <li>
    <p><strong>Set Clock Source</strong>:<br />
 In STM32CubeIDE, set the clock source of <code class="language-plaintext highlighter-rouge">TIM2</code> to <strong>Internal Clock</strong> to use the system clock as the timer’s clock source.</p>
  </li>
  <li>
    <p><strong>Set Counter Period and Prescaler</strong>:<br />
 Configure the <strong>Counter Period</strong> (<code class="language-plaintext highlighter-rouge">ARR</code>) and <strong>Prescaler</strong> (<code class="language-plaintext highlighter-rouge">PSC</code>) values to achieve the desired timer frequency:</p>

    <p>\[
 f_\text{PWM} =\frac{f_\text{Clock Frequency}}{(ARR-1) \cdot (PSC-1)}
 \]</p>

    <p>This equation determines the frequency at which the timer overflows and triggers an interrupt or updates its count.</p>
  </li>
  <li>
    <p><strong>Enable Auto-Reload Preload</strong>:<br />
 Enable the <strong>Auto-Reload Preload</strong> to ensure that the counter resets seamlessly upon reaching the <code class="language-plaintext highlighter-rouge">ARR</code> value.</p>
  </li>
</ol>

<h3 id="initialization-and-interrupt-configuration">6.2. <span class="me-2">Initialization and Interrupt Configuration</span><a href="#initialization-and-interrupt-configuration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>To initialize the timer and configure it for interrupt generation, include the following code in your initialization function:</p>

<pre><code class="language-cpp">static void MX_TIM2_Init(void) {
    // Initialize TIM2
    htim2.Instance = TIM2;  
    // Set prescaler to divide clock by 9600 (96 MHz / 9600 = 10 kHz)
    htim2.Init.Prescaler = 9599;  
    htim2.Init.CounterMode = TIM_COUNTERMODE_UP;
    // Set period for 1 Hz frequency (10 kHz / 10000 = 1 Hz)
    htim2.Init.Period = 9999;
    htim2.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;
    htim2.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_ENABLE;  // Enable auto-reload preload
    
    // Initialize the timer
    if (HAL_TIM_Base_Init(&amp;htim2) != HAL_OK) Error_Handler();
    
    // Start the timer with interrupt enabled
    if (HAL_TIM_Base_Start_IT(&amp;htim2) != HAL_OK) Error_Handler(); 
}
</code></pre>

<h3 id="handling-timer-interrupts">6.3. <span class="me-2">Handling Timer Interrupts</span><a href="#handling-timer-interrupts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>To handle timer interrupts, define the interrupt callback function:</p>

<pre><code class="language-cpp">void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim) {
    // Check if the interrupt is from TIM2
    if (htim-&gt;Instance == TIM2) {
        // Toggle an LED on GPIO pin PC13 as an example
        HAL_GPIO_TogglePin(GPIOC, GPIO_PIN_13);  
    }
}
</code></pre>

<p>This function is called whenever the timer reaches its period value and generates an interrupt, allowing you to execute time-based tasks, such as toggling an LED or triggering other events.</p>

<h2 id="usb-serial-communication-setup">7. <span class="me-2">USB Serial Communication Setup</span><a href="#usb-serial-communication-setup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>In this section, we will detail the setup and configuration of the Universal Serial Bus On-The-Go Full Speed (<code class="language-plaintext highlighter-rouge">USB OTG FS</code>) interface on the STM32 platform, which is compliant with the USB 2.0 standard. This interface is crucial for enabling USB communication, requiring a dedicated 48 MHz clock sourced from the High-Speed External (<code class="language-plaintext highlighter-rouge">HSE</code>) oscillator, as specified in the device’s datasheet (refer to section 3.27).</p>

<h3 id="configuring-the-usb-otg-fs-clock">7.1. <span class="me-2">Configuring the USB OTG FS Clock</span><a href="#configuring-the-usb-otg-fs-clock" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>To ensure the <code class="language-plaintext highlighter-rouge">USB_OTG_FS</code> peripheral operates correctly, it must be supplied with a precise 48 MHz clock, derived from the High-Speed External (<code class="language-plaintext highlighter-rouge">HSE</code>) oscillator. This clock configuration is critical for maintaining the timing requirements stipulated by the USB 2.0 standard.</p>

<h4 id="step-by-step-clock-setup">7.1.1. <span class="me-2">Step-by-Step Clock Setup</span><a href="#step-by-step-clock-setup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<ol>
  <li>
    <p><strong>Activate the HSE and LSE Oscillators</strong>:</p>

    <ul>
      <li>Begin by configuring the RCC (Reset and Clock Control) settings in STM32CubeMX. Set both the High-Speed External (<code class="language-plaintext highlighter-rouge">HSE</code>) and Low-Speed External (<code class="language-plaintext highlighter-rouge">LSE</code>) clocks to use crystal oscillators, which offer superior stability compared to internal RC oscillators.</li>
    </ul>
  </li>
  <li>
    <p><strong>Configure the PLL (Phase-Locked Loop)</strong>:</p>

    <ul>
      <li>
        <p>The main PLL should be configured to generate a system clock that is a multiple of 48 MHz. For instance, if your application allows, you might set the HCLK (High-speed Clock) to 96 MHz, which can then be divided by two to achieve the required 48 MHz for the USB peripheral.</p>
      </li>
      <li>
        <p><strong>Example for STM32F411CEUx</strong>: This microcontroller typically uses a 25 MHz HSE and a 32.786 kHz LSE. Set the PLL to multiply the HSE to achieve a 96 MHz system clock, which can then be divided down to provide the 48 MHz USB clock directly from the Main PLL.</p>
      </li>
      <li>
        <p><strong>Diagram Reference</strong>: The clock tree configuration should be adjusted accordingly to ensure the USB_OTG_FS peripheral is fed the correct 48 MHz signal, as visualized below.</p>
      </li>
    </ul>
  </li>
</ol>

<p><a href="/assets/images/embedded/stm32_cubemx/clock_configuration.webp" class="popup img-link  shimmer"><img src="/assets/images/embedded/stm32_cubemx/clock_configuration.webp" alt="Clock Configuration Panel on STM32 CubeMX" loading="lazy"></a></p>

<p><strong>Figure 1: Clock Configuration for <code class="language-plaintext highlighter-rouge">USB_OTG_FS</code></strong></p>

<h3 id="usb-peripheral-configuration-in-stm32cubemx">7.2. <span class="me-2">USB Peripheral Configuration in STM32CubeMX</span><a href="#usb-peripheral-configuration-in-stm32cubemx" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>After ensuring the clock is properly configured, proceed with setting up the USB OTG FS peripheral to handle USB communication at the hardware level.</p>

<h4 id="detailed-configuration-steps">7.2.1. <span class="me-2">Detailed Configuration Steps</span><a href="#detailed-configuration-steps" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<ol>
  <li>
    <p><strong>Enable USB OTG FS</strong>:</p>

    <ul>
      <li>Within STM32CubeMX, navigate to <strong>Connectivity</strong> and select <strong>USB_OTG_FS</strong>.</li>
      <li>Set the mode to <strong>Device Only</strong>, as this will configure the STM32 to act as a USB device when connected to a host system such as a PC.</li>
    </ul>
  </li>
  <li>
    <p><strong>Set Up the USB Device Middleware</strong>:</p>

    <ul>
      <li>
        <p>Under <strong>Middleware</strong>, select <strong>USB_DEVICE</strong>. For serial communication over USB, choose the <strong>Communication Device Class (CDC)</strong>, commonly referred to as <em>Virtual COM Port</em>. This selection enables the microcontroller to communicate with a host as if it were a standard serial port.</p>
      </li>
      <li>
        <p>Customize the USB device descriptors (such as the <code class="language-plaintext highlighter-rouge">PRODUCT_String</code>) within the <strong>Device Descriptor</strong> settings. These descriptors define how the USB device is identified by the host system, allowing for easier recognition and differentiation.</p>
      </li>
      <li>
        <p><strong>Note</strong>: The USB_DEVICE middleware operates in conjunction with the <code class="language-plaintext highlighter-rouge">STM32_USB_DEVICE_Library</code>, which houses the core USB functionality, referred to as <code class="language-plaintext highlighter-rouge">usb_core</code>. The core library manages fundamental USB operations but delegates higher-level communication protocols to other modules.</p>
      </li>
    </ul>
  </li>
</ol>

<h3 id="memory-management-adjusting-the-heap-size">7.3. <span class="me-2">Memory Management: Adjusting the Heap Size</span><a href="#memory-management-adjusting-the-heap-size" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>To ensure the microcontroller can handle USB communication efficiently, particularly when dealing with data buffers, it is necessary to adjust the default heap size.</p>

<h4 id="heap-size-adjustment">7.3.1. <span class="me-2">Heap Size Adjustment</span><a href="#heap-size-adjustment" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<ol>
  <li>
    <p><strong>Increase Heap Size</strong>:</p>

    <ul>
      <li>
        <p>Access the <strong>Project Manager</strong> tab in STM32CubeMX. By default, the heap size may be set to 0x200 (512 bytes), which is often insufficient for USB operations.</p>
      </li>
      <li>
        <p>Increase the heap size to 0x600 (1536 bytes). This additional memory allocation is crucial for accommodating the buffers required by the USB communication stack, ensuring smooth data transmission and reception.</p>
      </li>
    </ul>
  </li>
</ol>

<p>To ensure the heap size has increased we can look at the linker script</p>

<pre><code class="language-cpp">/* Entry Point */
ENTRY(Reset_Handler)

/* Highest address of the user mode stack */
_estack = ORIGIN(RAM) + LENGTH(RAM);    /* End of RAM */

/* Define heap and stack sizes */
_Min_Heap_Size = 0x600;      /* Required amount of heap (1.5KB) */
_Min_Stack_Size = 0x400;     /* Required amount of stack (1KB) */

/* Specify the memory areas */
MEMORY
{
  RAM (xrw)      : ORIGIN = 0x20000000, LENGTH = 128K
  FLASH (rx)     : ORIGIN = 0x08000000, LENGTH = 512K
}
</code></pre>

<ul>
  <li><strong>Heap Size</strong>: Updated to <code class="language-plaintext highlighter-rouge">0x600</code> (1536 bytes) to ensure sufficient memory for USB operations.</li>
  <li><strong>Stack Size</strong>: Maintained at <code class="language-plaintext highlighter-rouge">0x400</code> (1024 bytes) to support typical stack usage scenarios.</li>
</ul>

<h3 id="customizing-usb-communication-in-usbd_cdc_ifc">7.4. <span class="me-2">Customizing USB Communication in <code class="language-plaintext highlighter-rouge">usbd_cdc_if.c</code></span><a href="#customizing-usb-communication-in-usbd_cdc_ifc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>To ensure that the device and the host computer agree on communication parameters such as baud rate, parity, and stop bits, the <code class="language-plaintext highlighter-rouge">usbd_cdc_if.c</code> file must be modified. This file also handles the reception of data from the USB interface.</p>

<h4 id="modifying-line-coding-commands">7.4.1. <span class="me-2">Modifying Line Coding Commands</span><a href="#modifying-line-coding-commands" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<ol>
  <li>
    <p><strong>Storing Line Coding Information</strong>:</p>

    <ul>
      <li>To handle the Line Coding commands, add a variable of type <code class="language-plaintext highlighter-rouge">USBD_CDC_LineCodingTypeDef</code> to store the communication settings.</li>
    </ul>

    <p>In the block for adding private variables (<code class="language-plaintext highlighter-rouge">PV</code>):</p>

    <pre><code class="language-cpp"> /* USER CODE BEGIN PV */
 /* Private variables ---------------------------------------------------------*/
 USBD_CDC_LineCodingTypeDef LineCoding;
 /* USER CODE END PV */
</code></pre>
  </li>
  <li>
    <p><strong>Handling SET and GET Line Coding Requests</strong>:</p>

    <ul>
      <li>Modify the <code class="language-plaintext highlighter-rouge">CDC_Control_FS</code> function to handle <code class="language-plaintext highlighter-rouge">CDC_SET_LINE_CODING</code> and <code class="language-plaintext highlighter-rouge">CDC_GET_LINE_CODING</code> requests. This ensures the device correctly receives and responds to the host’s communication settings.</li>
    </ul>

    <pre><code class="language-cpp"> case CDC_SET_LINE_CODING:
     LineCoding.bitrate = 
     (uint32_t)((pbuf[0]) | (pbuf[1] &lt;&lt; 8) | (pbuf[2] &lt;&lt; 16) | (pbuf[3] &lt;&lt; 24));
     LineCoding.format = pbuf[4];
     LineCoding.paritytype = pbuf[5];
     LineCoding.datatype = pbuf[6];
 break;
 case CDC_GET_LINE_CODING:
     pbuf[0] = (uint8_t)(LineCoding.bitrate);
     pbuf[1] = (uint8_t)(LineCoding.bitrate &gt;&gt; 8);
     pbuf[2] = (uint8_t)(LineCoding.bitrate &gt;&gt; 16);
     pbuf[3] = (uint8_t)(LineCoding.bitrate &gt;&gt; 24);
     pbuf[4] = LineCoding.format;
     pbuf[5] = LineCoding.paritytype;
     pbuf[6] = LineCoding.datatype;
 break;
</code></pre>

    <ul>
      <li>This implementation ensures that both the computer and the device agree on the communication parameters.</li>
    </ul>
  </li>
</ol>

<h4 id="handling-data-reception">7.4.2. <span class="me-2">Handling Data Reception</span><a href="#handling-data-reception" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<ol>
  <li>
    <p><strong>Creating a Hook for Data Reception</strong>:</p>

    <ul>
      <li>Define a weak function <code class="language-plaintext highlighter-rouge">CDC_Receive_Handler</code> that can be overridden to handle incoming data. This provides flexibility by allowing custom data handling outside of the default library implementation.</li>
    </ul>

    <p>In the block for private function declarations:</p>

    <ul>
      <li>A weak function is only compiled if implemented; otherwise, all calls to it are ignored, which helps avoid unnecessary code execution.</li>
    </ul>

    <pre><code class="language-cpp"> __weak void CDC_Receive_Handler(uint8_t* pbuf, uint32_t *Len);
</code></pre>
  </li>
  <li>
    <p><strong>Modifying <code class="language-plaintext highlighter-rouge">CDC_Receive_FS</code> Function</strong>:</p>

    <ul>
      <li>Modify the <code class="language-plaintext highlighter-rouge">CDC_Receive_FS</code> function to call the <code class="language-plaintext highlighter-rouge">CDC_Receive_Handler</code> whenever data is received. This ensures that received data is processed as soon as it arrives.</li>
    </ul>

    <pre><code class="language-cpp"> static int8_t CDC_Receive_FS(uint8_t* Buf, uint32_t *Len)
 {
   /* USER CODE BEGIN 6 */
   USBD_CDC_SetRxBuffer(&amp;hUsbDeviceFS, &amp;Buf[0]);
   USBD_CDC_ReceivePacket(&amp;hUsbDeviceFS);
   CDC_Receive_Handler(Buf, Len);   /* &lt;-- added here */
   return (USBD_OK);
   /* USER CODE END 6 */
 }
</code></pre>

    <ul>
      <li>This function must execute quickly to ensure that the USB interface can continue processing incoming data without delays.</li>
    </ul>
  </li>
</ol>

<h3 id="finalizing-the-usb-communication-setup">7.5. <span class="me-2">Finalizing the USB Communication Setup</span><a href="#finalizing-the-usb-communication-setup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Once the clock and peripheral configurations are complete, and the project code is generated by STM32CubeMX, the final step involves refining the generated code to suit your application’s specific needs.</p>

<h4 id="code-customization">7.5.1. <span class="me-2">Code Customization</span><a href="#code-customization" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<ol>
  <li>
    <p><strong>Generated Code Overview</strong>:</p>

    <ul>
      <li>STM32CubeMX will generate several key files, including <code class="language-plaintext highlighter-rouge">usb_device.c</code>, <code class="language-plaintext highlighter-rouge">usbd_desc.c</code>, and <code class="language-plaintext highlighter-rouge">usb_cdc_if.c</code>. These files contain the foundational code for USB communication, including initialization routines and descriptor settings.</li>
    </ul>
  </li>
  <li>
    <p><strong>Editing <code class="language-plaintext highlighter-rouge">usb_cdc_if.c</code></strong>:</p>

    <ul>
      <li>
        <p>The file <code class="language-plaintext highlighter-rouge">usb_cdc_if.c</code> is where the core data handling functions are implemented. This is the primary location for customizing how data is sent and received over USB. Modify these functions to align with your application’s communication protocol and data handling requirements.</p>
      </li>
      <li>
        <p><strong>Middleware Structure</strong>:</p>

        <ul>
          <li><code class="language-plaintext highlighter-rouge">usb_device.c</code>: Manages the core USB device functionality.</li>
          <li><code class="language-plaintext highlighter-rouge">usbd_desc.c</code>: Contains the USB device descriptors, which define how the device appears to the host.</li>
          <li><code class="language-plaintext highlighter-rouge">usb_cdc_if.c</code>: Implements the interface for the CDC class, handling data transfers between the microcontroller and the USB host.</li>
        </ul>
      </li>
    </ul>
  </li>
</ol>

<p>By carefully following these steps, you will configure a robust and efficient USB communication interface on your STM32 microcontroller. The process involves precise clock setup, enabling and configuring the appropriate peripherals, adjusting memory allocations, and customizing the generated code to meet your application’s specific needs. This comprehensive approach ensures reliable and high-performance USB communication, suitable for a wide range of embedded applications.</p>

<h2 id="configuring-analog-channels-on-stm32">8. <span class="me-2">Configuring Analog Channels on STM32</span><a href="#configuring-analog-channels-on-stm32" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Setting up analog channels on the STM32 microcontroller involves several key steps, particularly when configuring the ADC (Analog-to-Digital Converter) to read analog signals. This section will guide you through the process of declaring pins as analog inputs, configuring the ADC for optimal performance, and utilizing internal references such as the temperature sensor and voltage reference.</p>

<h3 id="selecting-analog-input-pins">8.1. <span class="me-2">Selecting Analog Input Pins</span><a href="#selecting-analog-input-pins" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Before proceeding with the configuration, it’s essential to identify which pins you will declare as analog inputs. This decision is crucial because changing the configuration later can be complex and may require reworking the hardware setup or significant software adjustments.</p>

<h2 id="adc-configuration">9. <span class="me-2">ADC Configuration</span><a href="#adc-configuration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>The ADC peripheral in STM32 microcontrollers is highly versatile, capable of converting multiple analog inputs simultaneously using DMA (Direct Memory Access) for efficient data handling. The following steps outline the configuration process:</p>

<ol>
  <li>
    <p><strong>Selecting ADC Channels (ADCx)</strong>:</p>

    <ul>
      <li><strong>Input Channels (INx)</strong>: Choose the specific analog pins (INx) you intend to use as input channels. Each INx corresponds to a physical pin on the microcontroller.</li>
      <li><strong>Internal Channels</strong>: Additionally, you can select internal channels such as the temperature sensor and the internal voltage reference (<code class="language-plaintext highlighter-rouge">Vrefint</code>), which are invaluable for monitoring the microcontroller’s operating conditions.</li>
    </ul>
  </li>
  <li>
    <p><strong>Configuring DMA Settings</strong>:</p>

    <ul>
      <li><strong>DMA Channel</strong>: Add <code class="language-plaintext highlighter-rouge">ADC1</code> to the DMA settings. This will allow the ADC to transfer conversion results directly to memory without CPU intervention.</li>
      <li><strong>Data Width</strong>: Set the data width to “WORD” to ensure that each conversion result is stored in a 32-bit word format.</li>
      <li><strong>Mode</strong>: Enable “Circular” mode for DMA. This mode allows continuous ADC conversions, where the DMA automatically restarts after each full transfer, ideal for real-time data acquisition.</li>
    </ul>
  </li>
  <li>
    <p><strong>Adjusting ADC Parameters</strong>:</p>

    <ul>
      <li><strong>Continuous Conversion Mode</strong>: Enable this mode to allow the ADC to continuously convert the selected channels without requiring additional triggers.</li>
      <li><strong>DMA Continuous Request</strong>: Enable this to keep the DMA in sync with the continuous ADC conversions, ensuring that each conversion result is automatically transferred to memory.</li>
      <li><strong>Number of Conversions</strong>: Set this parameter to the number of channels you have configured. This determines how many conversions the ADC performs before resetting.</li>
      <li><strong>Clock Prescaler</strong>: Set the prescaler to divide <code class="language-plaintext highlighter-rouge">PCLK2</code> by 4. Given our configuration with a <code class="language-plaintext highlighter-rouge">PCLK2</code> of 96 MHz, this results in an ADC clock of 24 MHz.</li>
      <li><strong>Sampling Time Calculation</strong>: To determine the conversion time, divide the number of cycles by the ADC clock. For example:
        <ul>
          <li><strong>3 Cycles</strong>: 324 MHz=0.125 microseconds\frac{3}{24 \text{ MHz}} = 0.125 \text{ microseconds}24 MHz3​=0.125 microseconds. This is extremely fast and might not be suitable for accurate conversions.</li>
          <li><strong>480 Cycles</strong>: 48024 MHz=20 microseconds\frac{480}{24 \text{ MHz}} = 20 \text{ microseconds}24 MHz480​=20 microseconds. This is a more reasonable time, balancing speed and accuracy for most applications.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Implementing the ADC in the Main Program</strong>:</p>

    <ul>
      <li>After configuring the ADC, a handle (<code class="language-plaintext highlighter-rouge">hadc1</code>) will be available in your main program. To store the ADC conversion results, declare a buffer:</li>
    </ul>

    <pre><code class="language-cpp"> uint32_t pData[2] = {0};  // Buffer to hold ADC conversion results
</code></pre>

    <ul>
      <li>Start the ADC with DMA to begin storing conversion results in the buffer:</li>
    </ul>

    <pre><code class="language-cpp"> HAL_ADC_Start_DMA(&amp;hadc1, pData, 2);  // Start ADC with DMA, storing results in pData
</code></pre>
  </li>
</ol>

<h2 id="internal-voltage-reference-vrefint">10. <span class="me-2">Internal Voltage Reference (<code class="language-plaintext highlighter-rouge">Vrefint</code>)</span><a href="#internal-voltage-reference-vrefint" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>The STM32 microcontrollers include an internal voltage reference (<code class="language-plaintext highlighter-rouge">Vrefint</code>), which is particularly useful for compensating for power supply variations or for calibrating measurements. According to the STM32 datasheet (Section 6.3.23), the typical value of <code class="language-plaintext highlighter-rouge">Vrefint</code> is 1.21V. You can use this reference to calculate the actual voltage of an input pin as follows:</p>

<pre><code class="language-cpp">voltage = value_pinA0 * 1210 / value_Vrefint;  // Calculate voltage in mV
</code></pre>

<p>This formula assumes that <code class="language-plaintext highlighter-rouge">value_pinA0</code> is the ADC reading of the target pin, and <code class="language-plaintext highlighter-rouge">value_Vrefint</code> is the ADC reading of <code class="language-plaintext highlighter-rouge">Vrefint</code>. The result gives you the pin voltage in millivolts.</p>

<h3 id="utilizing-the-internal-temperature-sensor">10.1. <span class="me-2">Utilizing the Internal Temperature Sensor</span><a href="#utilizing-the-internal-temperature-sensor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The internal temperature sensor in STM32 microcontrollers is useful for monitoring the temperature of the microcontroller itself, which can be an indicator of ambient temperature or the device’s thermal performance. However, note that the sensor primarily measures the temperature of the silicon die, which may not reflect rapid ambient temperature changes due to the sensor’s thermal inertia.</p>

<h4 id="calculating-temperature">10.1.1. <span class="me-2">Calculating Temperature</span><a href="#calculating-temperature" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>The temperature can be calculated using the following formula derived from the sensor’s characteristics:</p>

<p>\[
T= \frac{V_\text{temp} - V_{25}}{ \text{slope}} + 25
\]</p>

<p>Where:</p>

<ul>
  <li>VtempV_{temp}Vtemp​ is the ADC reading of the temperature sensor.</li>
  <li>V25V_{25}V25​ is the voltage corresponding to 25°C, typically 0.76V (as per Section 6.3.21 of the datasheet).</li>
  <li>The slope is the change in voltage per degree Celsius.</li>
</ul>

<p>To implement this in code, assuming you are working in millivolts, the formula can be expressed as:</p>

<pre><code class="language-cpp">temp = ((V_temp * 3300) / 4095 - 760) * 1000 / slope + 25;
</code></pre>

<p>For the STM32, where the slope might be around 2.5 mV/°C, you could simplify this further:</p>

<pre><code class="language-cpp">temp = ((V_temp * 33000) / 4095 - 7600 + 25000) / 25;
</code></pre>

<p>This calculation yields the temperature in degrees Celsius, adjusting for the reference voltage and typical sensor characteristics.</p>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/embedded-development/">Embedded-Development</a>,
          <a href="/categories/stm32/">STM32</a>,
          <a href="/categories/stm32f411ceu6/">STM32F411CEU6</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/embedded/"
            class="post-tag no-text-decoration"
          >Embedded</a>
        
          <a
            href="/tags/stm32/"
            class="post-tag no-text-decoration"
          >STM32</a>
        
          <a
            href="/tags/blackpill/"
            class="post-tag no-text-decoration"
          >blackpill</a>
        
          <a
            href="/tags/stm32f411ceu6/"
            class="post-tag no-text-decoration"
          >STM32F411CEU6</a>
        
          <a
            href="/tags/arm/"
            class="post-tag no-text-decoration"
          >ARM</a>
        
          <a
            href="/tags/cortex-m4/"
            class="post-tag no-text-decoration"
          >Cortex-m4</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/CPP-Coroutines/">C++20 - Coroutines</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/Exploring-Exception-Handling-Mechanisms-in-Embedded-Environments/">Efficient Exception Handling in Resource-Constrained Embedded Systems</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/CMake-Production/">CMake - Publish Your Own Library</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/CMake-Integrating-C++-Libraries/">CMake - Integrating C++ Libraries</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/CMake-On-Windows/">CMake - Installation On Windows</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/c/">C++</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/software/">Software</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/cmake/">Cmake</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/windows/">Windows</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/arm/">ARM</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/embedded/">Embedded</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/stm32/">STM32</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/blackpill/">blackpill</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/build-systems/">Build-Systems</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/c-20/">C++20</a>
      
    </div>
  </section>


            </div>

            
              
              



  <section id="toc-wrapper" class="d-none ps-0 pe-4">
    <h2 class="panel-heading ps-3 mb-2">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  
    
  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/Exploring-Exception-Handling-Mechanisms-in-Embedded-Environments/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1703245260"
  data-df="ll"
  
>
  Dec 22, 2023
</time>

              <h4 class="pt-0 my-2">10.1.2. Efficient Exception Handling in Resource-Constrained Embedded Systems</h4>
              <div class="text-muted">
                <p>Introduction

This article provides a comprehensive analysis of exception handling mechanisms specifically designed for embedded systems, where resource constraints and performance optimization are...</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <div class="btn btn-outline-primary disabled" aria-label="Older">
      <p>-</p>
    </div>
  

  
    <a
      href="/posts/CMake-Brief-Reference/"
      class="btn btn-outline-primary"
      aria-label="Newer"
    >
      <p>CMake - Brief Reference</p>
    </a>
  
</nav>

            
              
              <!-- The comments switcher -->


            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>©
    <time>2024</time>

    
      <a href="https://github.com/mustafaalotbah">Mustafa Alotbah</a>.
    

    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>Using the <a
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="v7.0.1"
        href="https://github.com/cotes2020/jekyll-theme-chirpy"
        target="_blank"
        rel="noopener"
      >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/c/">C++</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/software/">Software</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/cmake/">Cmake</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/windows/">Windows</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/arm/">ARM</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/embedded/">Embedded</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/stm32/">STM32</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/blackpill/">blackpill</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/build-systems/">Build-Systems</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/c-20/">C++20</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- JavaScripts -->
    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->




  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.11/dayjs.min.js,npm/dayjs@1.11.11/locale/en.min.js,npm/dayjs@1.11.11/plugin/relativeTime.min.js,npm/dayjs@1.11.11/plugin/localizedFormat.min.js,npm/tocbot@4.27.20/dist/tocbot.min.js"></script>






<script src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  







    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2>11. <a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
    noResultsText: '<p class="mt-5">Oops! No results found.</p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>


  </body>
</html>
